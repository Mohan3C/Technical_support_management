{% extends "agent/base.html" %}

{% block content %}

<div class="min-h-screen ">
    <div class="bg-gray-200 flex flex-col py-5 mx-[10%] px-5 ">
        {% if ticket %}
        <div class="flex flex-1 justify-between">
            <div class="flex flex-col">
                <h2 class="px-5 py-2 text-white bg-indigo-500 mb-1 font-bold rounded-t">Type</h2>
                <p class="px-5 py-2 bg-white mb-5 uppercase rounded-b ">{{ticket.problem_type}}</p>
            </div>
            <div class="flex flex-col">
                <h2 class="px-5 py-2 text-white bg-indigo-500 mb-1 font-bold rounded-t">Priroity</h2>
                <p class="px-5 py-2 bg-white mb-5 uppercase rounded-b">{{ticket.priority}}</p>
            </div>
            <div class="flex flex-col">
                <h2 class="px-5 py-2 text-white bg-indigo-500 mb-1 font-bold rounded-t">Status</h2>
                <p class="px-5 py-1 bg-white mb-5 uppercase rounded-b">{{ticket.status}}</p>
            </div>
            <div class="flex flex-col">
                <h2 class="px-5 py-2 text-white bg-indigo-500 mb-1 font-bold rounded-t">Created</h2>
                <p class="px-5 py-1 bg-white mb-5 rounded-b">{{ticket.created_at|date:"d F Y"}}</p>
            </div>
        </div>
        <div class="flex flex-col">
            <h2 class="px-5 py-2 text-white bg-indigo-500 mb-1 font-bold rounded-t">Title</h2>
            <p class="px-5 py-2 bg-white mb-5 rounded-b">{{ticket.title}}</p>
        </div>
        <div class="flex flex-col">
            <h2 class="px-5 py-2 text-white bg-indigo-500 mb-1 font-bold rounded-t">Description</h2>
            <p class="px-5 py-2 bg-white mb-5 rounded-b ">{{ticket.description}}</p>
        </div>
        {% if ticket.image %}
        <div class="flex flex-col">
            <h2 class="px-5 py-2 text-white bg-indigo-500 font-bold rounded-t ">Image</h2>
            <a href="{{ticket.image.url}}" target="_blank"> <img src="{{ticket.image.url}}" alt="Not Available"
                    class="px-5 pb-2 mb-5 h-[100px] w-[100px]"></a>
        </div>
        {% endif %}
        <div class="flex flex-col">
            <div class="bg-indigo-400 flex flex-1 justify-between items-center rounded-t">
                <h2 class="px-5 py-2 text-white  font-bold">Chat with customer</h2>
                {% if ticket.status != "closed" %}
                <a href="{% url 'close_ticket' ticket.id %}" class="px-4 py-2 bg-blue-500 text-white font-semibold rounded ">Close</a>
                {% endif %}
            </div>
            {% if comments %}
            <div class="bg-white px-5 pt-5 ">
                {% for comment in comments %}
                {% if comment.user == request.user %}
                <div class="flex flex-1 justify-end justify-between">
                    <span class="flex px-10 pt-3 text-sm text-gray-600">{{comment.created_at|date:"d F Y"}}</span>
                    <div class="flex flex-col">
                        {% if comment.image %}
                        <a href="{{comment.image.url}}" target="_blank"> <img src="{{comment.image.url}}" class="px-5 pb-2 mb-5 h-[100px] w-[100px]"></a>
                        {% endif %}
                        <p class="px-5 py-2 bg-rose-100 self-start rounded-full mb-4 mt-1 mr-5 ">{{comment.content}}</p>
                    </div>
                </div>
                {% else %}
                <div class="flex flex-col">
                    <div class="flex flex-1 justify-between">
                        <h2 class="px-3 ml-4 py-1 bg-rose-300 self-start rounded-lg">{{comment.user.username}}</h2>
                        <span class="flex px-10 pt-3 text-sm text-gray-600 justify-end">{{comment.created_at|date:"d F Y"}}</span>
                    </div>
                    <div class="flex flex-col">
                         {% if comment.image %}
                        <a href="{{comment.image.url}}" target="_blank"> <img src="{{comment.image.url}}" class="px-5 pb-2 mb-5 h-[100px] w-[100px]"></a>
                        {% endif %}
                        <p class="px-5 py-2 bg-rose-100 self-start rounded-full ml-[8%] mb-4 mt-1 ">{{comment.content}}</p>
                    </div>
                </div>
                {% endif %}
                {% endfor %}
            </div>
            {% endif %}
            {% if ticket.status != "closed"  %}
            <div class="px-5 bg-white pt-5">
                <form action="{% url 'agent_comment' ticket.id %}" method="post" class="flex flex-1 pb-2">
                    {% csrf_token %}
                    <textarea name="comment" placeholder="Write your issues" class="flex flex-1 pl-5 border border-gray-200 py-1 rounded-full"></textarea>
                    <button type="submit" class="px-[2%] font-bold hover:bg-red-600 hover:text-white rounded-full justify-center items-center ">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="black" viewBox="0 0 24 24" stroke-width="1.5"
                            stroke="currentColor" class="size-6">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                d="M6 12 3.269 3.125A59.769 59.769 0 0 1 21.485 12 59.768 59.768 0 0 1 3.27 20.875L5.999 12Zm0 0h7.5" />
                        </svg>

                    </button>
                </form>
            </div>
            {% endif %}
        </div>
        {% endif %}


    </div>
</div>

{% endblock %}