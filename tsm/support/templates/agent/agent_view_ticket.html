{% extends "agent/base.html" %}

{% block content %}

<div class="fl fle w-full bg-white ">

    <!-- old code

    <div class="bg-gray-200 flex flex-col py-5 mx-[10%] px-5 ">
        {% if ticket %}
        <div class="flex flex-1 justify-between">
            <div class="flex flex-col">
                <h2 class="px-5 py-2 text-white bg-indigo-500 mb-1 font-bold rounded-t">Type</h2>
                <p class="px-5 py-2 bg-white mb-5 uppercase rounded-b ">{{ticket.problem_type}}</p>
            </div>
            <div class="flex flex-col">
                <h2 class="px-5 py-2 text-white bg-indigo-500 mb-1 font-bold rounded-t">Priroity</h2>
                <p class="px-5 py-2 bg-white mb-5 uppercase rounded-b">{{ticket.priority}}</p>
            </div>
            <div class="flex flex-col">
                <h2 class="px-5 py-2 text-white bg-indigo-500 mb-1 font-bold rounded-t">Status</h2>
                <p class="px-5 py-1 bg-white mb-5 uppercase rounded-b">{{ticket.status}}</p>
            </div>
            <div class="flex flex-col">
                <h2 class="px-5 py-2 text-white bg-indigo-500 mb-1 font-bold rounded-t">Created</h2>
                <p class="px-5 py-1 bg-white mb-5 rounded-b">{{ticket.created_at|date:"d F Y"}}</p>
            </div>
        </div>
        <div class="flex flex-col">
            <h2 class="px-5 py-2 text-white bg-indigo-500 mb-1 font-bold rounded-t">Title</h2>
            <p class="px-5 py-2 bg-white mb-5 rounded-b">{{ticket.title}}</p>
        </div>
        <div class="flex flex-col">
            <h2 class="px-5 py-2 text-white bg-indigo-500 mb-1 font-bold rounded-t">Description</h2>
            <p class="px-5 py-2 bg-white mb-5 rounded-b ">{{ticket.description}}</p>
        </div>
        {% if ticket.image %}
        <div class="flex flex-col">
            <h2 class="px-5 py-2 text-white bg-indigo-500 font-bold rounded-t ">Image</h2>
            <a href="{{ticket.image.url}}" target="_blank"> <img src="{{ticket.image.url}}" alt="Not Available"
                    class="px-5 pb-2 mb-5 h-[100px] w-[100px]"></a>
        </div>
        {% endif %}
        <div class="flex flex-col">
            <div class="bg-indigo-400 flex flex-1 justify-between items-center rounded-t">
                <h2 class="px-5 py-2 text-white  font-bold">Chat with customer</h2>
                {% if ticket.status != "closed" %}
                <a href="{% url 'close_ticket' ticket.id %}" class="px-4 py-2 bg-blue-500 text-white font-semibold rounded ">Close</a>
                {% endif %}
            </div>
            {% if comments %}
            <div class="bg-white px-5 pt-5 ">
                {% for comment in comments %}
                {% if comment.user == request.user %}
                <div class="flex flex-1 justify-end justify-between">
                    <span class="flex px-10 pt-3 text-sm text-gray-600">{{comment.created_at|date:"d F Y"}}</span>
                    <div class="flex flex-col">
                        {% if comment.image %}
                        <a href="{{comment.image.url}}" target="_blank"> <img src="{{comment.image.url}}" class="px-5 pb-2 mb-5 h-[100px] w-[100px]"></a>
                        {% endif %}
                        <p class="px-5 py-2 bg-rose-100 self-start rounded-full mb-4 mt-1 mr-5 ">{{comment.content}}</p>
                    </div>
                </div>
                {% else %}
                <div class="flex flex-col">
                    <div class="flex flex-1 justify-between">
                        <h2 class="px-3 ml-4 py-1 bg-rose-300 self-start rounded-lg">{{comment.user.username}}</h2>
                        <span class="flex px-10 pt-3 text-sm text-gray-600 justify-end">{{comment.created_at|date:"d F Y"}}</span>
                    </div>
                    <div class="flex flex-col">
                         {% if comment.image %}
                        <a href="{{comment.image.url}}" target="_blank"> <img src="{{comment.image.url}}" class="px-5 pb-2 mb-5 h-[100px] w-[100px]"></a>
                        {% endif %}
                        <p class="px-5 py-2 bg-rose-100 self-start rounded-full ml-[8%] mb-4 mt-1 ">{{comment.content}}</p>
                    </div>
                </div>
                {% endif %}
                {% endfor %}
            </div>
            {% endif %}
            {% if ticket.status != "closed"  %}
            <div class="px-5 bg-white pt-5">
                <form action="{% url 'agent_comment' ticket.id %}" method="post" class="flex flex-1 pb-2">
                    {% csrf_token %}
                    <textarea name="comment" placeholder="Write your issues" class="flex flex-1 pl-5 border border-gray-200 py-1 rounded-full"></textarea>
                    <button type="submit" class="px-[2%] font-bold hover:bg-red-600 hover:text-white rounded-full justify-center items-center ">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="black" viewBox="0 0 24 24" stroke-width="1.5"
                            stroke="currentColor" class="size-6">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                d="M6 12 3.269 3.125A59.769 59.769 0 0 1 21.485 12 59.768 59.768 0 0 1 3.27 20.875L5.999 12Zm0 0h7.5" />
                        </svg>

                    </button>
                </form>
            </div>
            {% endif %}
        </div>
        {% endif %}


    </div> 

    end old code  -->

    <div class="w-full flex flex-1 ">
        <div
            class="{% if ticket.assign_to and comments %}w-5/12  border-x border-gray-600 {% else %}w-full flex justify-between{% endif %}  bg-[#F3F4F6] ">
            <div class="flex flex-col">
                <div class="px-[7%] py-3 flex flex-1 bg-[#735DA5]">
                    <div class="flex flex-1">
                        <h2 class="font-bold text-xl text-white">Ticket</h2>
                        <h2 class="mx-3 px-3 bg-slate-200 font-bold text-gray-900 text-xl">#{{ticket.id}}</h2>
                    </div>

                </div>
                <div class="px-[10%] py-3 flex flex-1 ">
                    <div class="flex flex-1 text-sm justify-start">
                        <h2 class="font-bold  px-1">Status-</h2>
                        <h2 class="px-2 bg-slate-400 font-bold text-white">{{ticket.status}}</h2>
                    </div>
                    <div class=" flex flex-1 justify-center ">
                        <h2 class="px-1 font-bold">Priority-</h2>
                        <h2 class="px-2 font-bold bg-slate-400 text-white">{{ticket.priority}}</h2>
                    </div>
                    <div class=" flex flex-1 justify-end ">
                        <h2 class="px-1 font-bold">Type-</h2>
                        <h2 class="px-2 font-bold bg-slate-400 text-white">{{ticket.problem_type}}</h2>
                    </div>
                </div>
                <div class=" bg-[#F3F4F6]">
                    <div class="flex flex-col">
                        <div class="mb-2 px-[10%] pt-3 flex flex-1 justify-between bg-[#F3F4F6]">
                            <h3 class=" pr-5 font-bold">Subject</h3>
                        </div>
                        <div class="px-[10%] pb-1 flex flex-1 ">
                            <h2 class="py-2 px-2 flex flex-1 bg-white border rounded whitespace-pre-line">{{ticket.title}}
                            </h2>
                        </div>
                        <div class="px-[10%] pt-3 flex flex-1 justify-between">
                            <h3 class="pr-5 font-bold">Description</h3>
                        </div>
                        <div class="px-[10%] pb-1 flex flex-1 ">
                            <h2 class=" py-2 flex flex-1 bg-white px-2 border rounded h-[245px] top-0 overflow-y-auto whitespace-pre-line">{{ticket.description}}</h2>
                        </div>

                        {% if ticket.image %}
                        <div class="px-[10%] pt-2 flex flex-1 justify-between ">
                            <h3 class=" pr-5 font-bold">Image</h3>
                        </div>
                        <div class="px-[10%] pb-1 flex flex-1 bg-[#F3F4F6] ">
                            <a href="{{ticket.image.url}}" target="_blank"> <img src="{{ticket.image.url}}" alt="Image"
                                    class="px-5 py-2 mb-5 bg-white h-[100px] w-[100px]"></a>
                        </div>
                        {% endif %}
                        <div class="px-[10%] mb-1 flex flex-1 justify-between">
                            <h3 class="  text-sm pr-5 font-bold">created at </h3>
                            <h3 class="px-5 py-2 text-sm pr-5 bg-[#EDE9FE] font-bold">{{ticket.created_at}} </h3>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div
            class="{% if ticket.assign_to and comments %}w-7/12 h-[795px] overflow-y-scroll bg-indigo-400 {% else %}hidden{% endif %} ">
            <div class="w-full min-h-screen">
                <div class="flex flex-col">
                    <div class="px-[4%] py-3 flex flex-1 bg-[#735DA5] top-0 sticky">
                        <div class="flex flex-1">
                            <h2 class="font-bold text-xl text-white">Chat with {{ticket.created_by.username}}</h2>
                        </div>
                    </div>
                    {% if comments %}
                    <div class="bg-[#F3F4F6] pt-5 ">
                        {% for comment in comments %}
                        {% if comment.user == request.user %}
                        <div class="ml-5 flex flex-col justify-end px-[20px]">
                            <p class="ml-[14%] mr-[6%] px-5 py-2 bg-white rounded mt-1 whitespace-pre-line flex   justify-end ">{{comment.content}}</p>
                            <span class="flex px-5 pt-3 mb-5 text-sm text-gray-600 justify-end">{{comment.created_at|date:"d F Y"}}</span>
                        </div>
                        {% else %}
                        <div class="flex flex-col pr-[20px] ">
                            <div class="flex flex-1 justify-between ">
                                <h2 class="px-3 ml-5 py-1 bg-rose-300 self-start rounded-full">
                                    {{comment.user.username|slice:":1"|upper}}</h2>
                                <span class="flex px-10 pt-3 text-sm text-gray-600  justify-end">{{comment.created_at|date:"d F Y"}}</span>
                            </div>
                            <p class=" mr-[14%] ml-[8%] px-5 py-2 mb-4 bg-white rounded whitespace-pre-line ">{{comment.content}}</p>
                        </div>
                        {% endif %}
                        {% endfor %}

                    </div>
                    {% endif %}
                    {% if ticket.status != "closed" %}
                    <div class="px-5 bg-[#F3F4F6] bottom-0 sticky">
                        <form action="{% url 'agent_comment' ticket.id %}" method="post" class="flex flex-1 pb-2">
                            {% csrf_token %}
                            <textarea name="comment" placeholder="Write your issues"
                                oninput="this.style.height = 'auto'; this.style.height = this.scrollHeight + 'px';"
                                class="flex flex-1 pl-5 border border-gray-200 py-1 min-h-[10px] max-h-[200px] rounded-lg bg-white"></textarea>
                            <button type="submit"
                                class="px-[2%] font-bold hover:bg-indigo-400 hover:text-white rounded-lg justify-center items-center ">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="black" viewBox="0 0 24 24"
                                    stroke-width="1.5" stroke="currentColor" class="size-6">
                                    <path stroke-linecap="round" stroke-linejoin="round"
                                        d="M6 12 3.269 3.125A59.769 59.769 0 0 1 21.485 12 59.768 59.768 0 0 1 3.27 20.875L5.999 12Zm0 0h7.5" />
                                </svg>

                            </button>
                        </form>
                    </div>
                    {% endif %}
                </div>

            </div>
        </div>

    </div>
</div>

{% endblock %}